import{S as V,aj as Z,r as E,aC as fe,x as me,B as _,v as W,s as pe,q as ve,o as y,_ as K,k as s,w as f,a as d,V as u,A as t,W as q,ad as ge,$ as N,c as L,J as G,ac as _e,aw as we,X as be,a1 as ke,T as he,a2 as Ie,a3 as Ce,ae as J,j as xe}from"./core-d086e217.js";import{e as ze,f as ye,m as Ee,i as Q,g as Ne,h as Oe,j as Te,E as w,k as Le,t as X,l as z,n as T,o as Ve,w as $e}from"./index-391c66f0.js";import{h as Ae,j as Re,d as Xe,k as Be,f as Ye,z as Se,n as Me,r as je,o as De}from"./elIcon-e456a308.js";import{E as U}from"./index-bb6527ef.js";import"./mock-d5a52175.js";const Fe=ze({urlList:{type:ye(Array),default:()=>Ee([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),Pe={close:()=>!0,switch:v=>Q(v)},He=["src"],Ze=V({name:"ElImageViewer"}),We=V({...Ze,props:Fe,emits:Pe,setup(v,{expose:b,emit:I}){const o=v,k={CONTAIN:{name:"contain",icon:Z(Ae)},ORIGINAL:{name:"original",icon:Z(Re)}},{t:B}=Ne(),l=Oe("image-viewer"),{nextZIndex:ee}=Te(),$=E(),Y=E([]),S=fe(),C=E(!0),g=E(o.initialIndex),O=me(k.CONTAIN),i=E({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=_(()=>{const{urlList:e}=o;return e.length<=1}),M=_(()=>g.value===0),j=_(()=>g.value===o.urlList.length-1),ae=_(()=>o.urlList[g.value]),ne=_(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!o.infinite&&M.value)]),se=_(()=>[l.e("btn"),l.e("next"),l.is("disabled",!o.infinite&&j.value)]),oe=_(()=>{const{scale:e,deg:a,offsetX:n,offsetY:r,enableTransition:m}=i.value;let c=n/e,p=r/e;switch(a%360){case 90:case-270:[c,p]=[p,-c];break;case 180:case-180:[c,p]=[-c,-p];break;case 270:case-90:[c,p]=[-p,c];break}const x={transform:`scale(${e}) rotate(${a}deg) translate(${c}px, ${p}px)`,transition:m?"transform .3s":""};return O.value.name===k.CONTAIN.name&&(x.maxWidth=x.maxHeight="100%"),x}),le=_(()=>Q(o.zIndex)?o.zIndex:ee());function A(){re(),I("close")}function ie(){const e=X(n=>{switch(n.code){case z.esc:o.closeOnPressEscape&&A();break;case z.space:F();break;case z.left:P();break;case z.up:h("zoomIn");break;case z.right:H();break;case z.down:h("zoomOut");break}}),a=X(n=>{const r=n.deltaY||n.deltaX;h(r<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});S.run(()=>{T(document,"keydown",e),T(document,"wheel",a)})}function re(){S.stop()}function ce(){C.value=!1}function ue(e){C.value=!1,e.target.alt=B("el.image.error")}function de(e){if(C.value||e.button!==0||!$.value)return;i.value.enableTransition=!1;const{offsetX:a,offsetY:n}=i.value,r=e.pageX,m=e.pageY,c=X(x=>{i.value={...i.value,offsetX:a+x.pageX-r,offsetY:n+x.pageY-m}}),p=T(document,"mousemove",c);T(document,"mouseup",()=>{p()}),e.preventDefault()}function D(){i.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function F(){if(C.value)return;const e=Ve(k),a=Object.values(k),n=O.value.name,m=(a.findIndex(c=>c.name===n)+1)%e.length;O.value=k[e[m]],D()}function R(e){const a=o.urlList.length;g.value=(e+a)%a}function P(){M.value&&!o.infinite||R(g.value-1)}function H(){j.value&&!o.infinite||R(g.value+1)}function h(e,a={}){if(C.value)return;const{zoomRate:n,rotateDeg:r,enableTransition:m}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":i.value.scale>.2&&(i.value.scale=Number.parseFloat((i.value.scale/n).toFixed(3)));break;case"zoomIn":i.value.scale<7&&(i.value.scale=Number.parseFloat((i.value.scale*n).toFixed(3)));break;case"clockwise":i.value.deg+=r;break;case"anticlockwise":i.value.deg-=r;break}i.value.enableTransition=m}return W(ae,()=>{pe(()=>{const e=Y.value[0];e!=null&&e.complete||(C.value=!0)})}),W(g,e=>{D(),I("switch",e)}),ve(()=>{var e,a;ie(),(a=(e=$.value)==null?void 0:e.focus)==null||a.call(e)}),b({setActiveItem:R}),(e,a)=>(y(),K(Ce,{to:"body",disabled:!e.teleported},[s(Ie,{name:"viewer-fade",appear:""},{default:f(()=>[d("div",{ref_key:"wrapper",ref:$,tabindex:-1,class:u(t(l).e("wrapper")),style:q({zIndex:t(le)})},[d("div",{class:u(t(l).e("mask")),onClick:a[0]||(a[0]=ge(n=>e.hideOnClickModal&&A(),["self"]))},null,2),N(" CLOSE "),d("span",{class:u([t(l).e("btn"),t(l).e("close")]),onClick:A},[s(t(w),null,{default:f(()=>[s(t(Xe))]),_:1})],2),N(" ARROW "),t(te)?N("v-if",!0):(y(),L(G,{key:0},[d("span",{class:u(t(ne)),onClick:P},[s(t(w),null,{default:f(()=>[s(t(Be))]),_:1})],2),d("span",{class:u(t(se)),onClick:H},[s(t(w),null,{default:f(()=>[s(t(Ye))]),_:1})],2)],64)),N(" ACTIONS "),d("div",{class:u([t(l).e("btn"),t(l).e("actions")])},[d("div",{class:u(t(l).e("actions__inner"))},[s(t(w),{onClick:a[1]||(a[1]=n=>h("zoomOut"))},{default:f(()=>[s(t(Se))]),_:1}),s(t(w),{onClick:a[2]||(a[2]=n=>h("zoomIn"))},{default:f(()=>[s(t(Me))]),_:1}),d("i",{class:u(t(l).e("actions__divider"))},null,2),s(t(w),{onClick:F},{default:f(()=>[(y(),K(_e(t(O).icon)))]),_:1}),d("i",{class:u(t(l).e("actions__divider"))},null,2),s(t(w),{onClick:a[3]||(a[3]=n=>h("anticlockwise"))},{default:f(()=>[s(t(je))]),_:1}),s(t(w),{onClick:a[4]||(a[4]=n=>h("clockwise"))},{default:f(()=>[s(t(De))]),_:1})],2)],2),N(" CANVAS "),d("div",{class:u(t(l).e("canvas"))},[(y(!0),L(G,null,we(e.urlList,(n,r)=>be((y(),L("img",{ref_for:!0,ref:m=>Y.value[r]=m,key:n,src:n,style:q(t(oe)),class:u(t(l).e("img")),onLoad:ce,onError:ue,onMousedown:de},null,46,He)),[[ke,r===g.value]])),128))],2),he(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var Ke=Le(We,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const qe=$e(Ke);function Ge(v){const b=document.createElement("div"),I=s(qe,Object.assign({onClose:function(){J(null,b),typeof v.onClose=="function"&&v.onClose.call(this)}},v));return J(I,b),document.body.appendChild(b.firstElementChild),I}const Je={class:"image-viewer"},Qe=V({setup:!0,name:"ImageViewer",getComponents:()=>[U]}),st=V({...Qe,__name:"imageViewer",setup(v){const b=()=>Ge({urlList:["https://scpic.chinaz.net/Files/pic/pic6/pic1281.jpg","https://scpic.chinaz.net/files/pic/pic9/202009/apic27858.jpg","https://tse3-mm.cn.bing.net/th/id/OIP-C.n0_p3rYRuofABd3XudbZnAHaEo?pid=ImgDet&rs=1"]});return(I,o)=>{const k=U;return y(),L("div",Je,[s(k,{onClick:o[0]||(o[0]=B=>b())},{default:f(()=>[xe(" 预览 ")]),_:1})])}}});export{st as default};
