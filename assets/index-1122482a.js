import{a as S,E as w,i as F,f as U}from"./index-c2d633e6.js";import{_ as M}from"./index-7be35ccf.js";import{h as z,k as R}from"./index-391c66f0.js";import{p as _}from"./index-589bce5d.js";import{a9 as H,B as C,s as V,S as L,n as W,v as q,O as $,L as D,r as P,a6 as x,q as G,a7 as p}from"./core-d086e217.js";import{U as A}from"./event-9519ab40.js";const J=(e,{attrs:c},{tree:i,key:u})=>{const o=z("tree-select"),n={..._(H(e),Object.keys(S.props)),...c,valueKey:u,popperClass:C(()=>{const s=[o.e("popper")];return e.popperClass&&s.push(e.popperClass),s.join(" ")}),filterMethod:(s="")=>{e.filterMethod&&e.filterMethod(s),V(()=>{var h;(h=i.value)==null||h.filter(s)})},onVisibleChange:s=>{var h;(h=c.onVisibleChange)==null||h.call(c,s),e.filterable&&s&&n.filterMethod()}};return n},Q=L({extends:w,setup(e,c){const i=w.setup(e,c);delete i.selectOptionClick;const u=W().proxy;return V(()=>{i.select.cachedOptions.get(u.value)||i.select.onOptionCreate(u)}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function T(e){return e||e===0}function j(e){return Array.isArray(e)&&e.length}function g(e){return Array.isArray(e)?e:T(e)?[e]:[]}function E(e,c,i,u,o){for(let n=0;n<e.length;n++){const s=e[n];if(c(s,n,e,o))return u?u(s,n,e,o):s;{const h=i(s);if(j(h)){const a=E(h,c,i,u,s);if(a)return a}}}}function B(e,c,i,u){for(let o=0;o<e.length;o++){const n=e[o];c(n,o,e,u);const s=i(n);j(s)&&B(s,c,i,n)}}const X=(e,{attrs:c,slots:i,emit:u},{select:o,tree:n,key:s})=>{q(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const t=n.value;t&&!F(t.getCheckedKeys(),g(e.modelValue))&&t.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const h=C(()=>({value:s.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),a=(t,l)=>{var d;const r=h.value[t];return $(r)?r(l,(d=n.value)==null?void 0:d.getNode(a("value",l))):l[r]},N=g(e.modelValue).map(t=>E(e.data||[],l=>a("value",l)===t,l=>a("children",l),(l,d,r,y)=>y&&a("value",y))).filter(t=>T(t)),k=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return B(e.data.concat(e.cacheData),l=>{const d=a("value",l);t.push({value:d,currentLabel:a("label",l),isDisabled:a("disabled",l)})},l=>a("children",l)),t}),m=C(()=>k.value.reduce((t,l)=>({...t,[l.value]:l}),{}));return{..._(H(e),Object.keys(M.props)),...c,nodeKey:s,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(t,{node:l,data:d,store:r})=>t(Q,{value:a("value",d),label:a("label",d),disabled:a("disabled",d)},e.renderContent?()=>e.renderContent(t,{node:l,data:d,store:r}):i.default?()=>i.default({node:l,data:d,store:r}):void 0),filterNodeMethod:(t,l,d)=>{var r;return e.filterNodeMethod?e.filterNodeMethod(t,l,d):t?(r=a("label",l))==null?void 0:r.includes(t):!0},onNodeClick:(t,l,d)=>{var r,y,K;if((r=c.onNodeClick)==null||r.call(c,t,l,d),!(e.showCheckbox&&e.checkOnClickNode))if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!a("disabled",t)){const f=(y=o.value)==null?void 0:y.options.get(a("value",t));(K=o.value)==null||K.handleOptionSelect(f)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick()},onCheck:(t,l)=>{if(!e.showCheckbox)return;const d=a("value",t),r=l.checkedKeys,y=e.multiple?g(e.modelValue).filter(f=>f in m.value&&!n.value.getNode(f)&&!r.includes(f)):[],K=r.concat(y);if(e.checkStrictly)u(A,e.multiple?K:K.includes(d)?d:void 0);else if(e.multiple)u(A,n.value.getCheckedKeys(!0));else{const f=E([t],v=>!j(a("children",v))&&!a("disabled",v),v=>a("children",v)),b=f?a("value",f):void 0,I=T(e.modelValue)&&!!E([t],v=>a("value",v)===e.modelValue,v=>a("children",v));u(A,b===e.modelValue||I?void 0:b)}V(()=>{var f;const b=g(e.modelValue);n.value.setCheckedKeys(b),(f=c.onCheck)==null||f.call(c,t,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})})},cacheOptions:k}};var Y=L({props:{data:{type:Array,default:()=>[]}},setup(e){const c=D(U);return q(()=>e.data,()=>{var i;e.data.forEach(o=>{c.cachedOptions.has(o.value)||c.cachedOptions.set(o.value,o)});const u=((i=c.selectWrapper)==null?void 0:i.querySelectorAll("input"))||[];Array.from(u).includes(document.activeElement)||c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Z=L({name:"ElTreeSelect",inheritAttrs:!1,props:{...S.props,...M.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:i,expose:u}=c,o=P(),n=P(),s=C(()=>e.nodeKey||e.valueKey||"value"),h=J(e,c,{select:o,tree:n,key:s}),{cacheOptions:a,...N}=X(e,c,{select:o,tree:n,key:s}),k=x({});return u(k),G(()=>{Object.assign(k,{..._(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),..._(o.value,["focus","blur"])})}),()=>p(S,x({...h,ref:m=>o.value=m}),{...i,default:()=>[p(Y,{data:a.value}),p(M,x({...N,ref:m=>n.value=m}))]})}});var O=R(Z,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tree-select/src/tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const ee=O,oe=ee;export{oe as E};
